FROM resin/%%RESIN_MACHINE_NAME%%-debian

ENV INITSYSTEM on

RUN apt-get update && apt-get install -yq --no-install-recommends \
	cron \
	rsnapshot \
	openssh-client \
	curl \
	&& apt-get clean && rm -rf /var/lib/apt/lists/*

COPY . /usr/src/app/
WORKDIR /usr/src/app

RUN mkdir /root/.ssh \
	&& chmod 700 /root/.ssh

RUN cp /usr/src/app/ssh_config.txt /root/.ssh/config \
	&& chmod 600 /root/.ssh/config

RUN crontab /usr/src/app/crontab.txt

CMD ["/bin/bash", "start.sh"]