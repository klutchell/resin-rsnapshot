FROM resin/%%RESIN_MACHINE_NAME%%-alpine:latest

ENV INITSYSTEM on

RUN apk add --no-cache \
    dcron \
	rsnapshot \
	openssh-client \
	curl \
	samba \
    samba-common-tools \
    supervisor

#COPY ssh_config /etc/ssh/ssh_config
COPY rsnapshot.cron /var/spool/cron/crontabs/rsnapshot

WORKDIR /config

COPY *.conf ./

# set a simple samba password for the root user
RUN echo -e "alpine\nalpine" | smbpasswd -a -s -c smb.conf root

WORKDIR /usr/src/app

COPY /app ./

CMD ["/bin/bash", "start.sh"]
